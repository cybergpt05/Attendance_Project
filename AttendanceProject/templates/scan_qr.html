<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan QR Code</title>
    <script type="module">
    import QrScanner from "https://unpkg.com/qr-scanner@latest/qr-scanner.min.js";

    document.addEventListener("DOMContentLoaded", function () {
        const video = document.getElementById("qr-video");
        const alertDiv = document.getElementById("alertDiv");

        // إعداد الماسح الضوئي
        const scanner = new QrScanner(video, async result => {
            handleScanResult(result);
        }, {
            preferredCamera: 'environment', // تحديد الكاميرا الخلفية تلقائيًا
            returnDetailedScanResult: true
        });

        scanner.start();

        function handleScanResult(result) {
            if (result) {
                window.location.href = result.data;
            } else {
                showAlert("لم يتم العثور على كود QR، تأكد من وضوح الصورة", "danger");
            }
        }

        function showAlert(message, type) {
            alertDiv.innerHTML = message;
            alertDiv.className = `alert alert-${type} text-center mt-5`;
            alertDiv.hidden = false;
        }
    });
</script>

</head>
<body>
    <div class="container">
        <div class="card shadow">
            <fieldset class="form-group">
                <center class="fw-bold mb-5" style="font-size: 1.5rem !important;">Scan QR Code</center>
                <div class="form-group">
                    <input type="file" id="qrImageInput" class="form-control mb-3" capture="environment" accept="image/*">
                    <div id="alertDiv" class="alert text-center mt-5" role="alert" hidden></div>
                </div>
            </fieldset>
        </div>
    </div>
</body>
</html>
