{% extends "layout2.html" %}
{% block content %}
<link rel="stylesheet" href="{{url_for('static',filename='login.css')}}">
<script src="https://cdn.jsdelivr.net/npm/@zxing/browser@latest"></script>

<div class="container">
    <div class="card shadow">
        <fieldset class="form-group">
            <center class="fw-bold mb-5" style="font-size: 1.5rem !important;">Scan QR Code</center>
            <div class="form-group">
                <input type="file" id="qrImageInput" class="form-control mb-3" capture="environment" accept="image/*">
                <button id="scanButton" class="btn login-button fw-bold mt-5" style="margin-left: auto; margin-right: auto;">Scan</button>
                <canvas id="qrCanvas" style="display: none;"></canvas>
                <div id="alertDiv" class="alert text-center mt-5" role="alert" hidden></div>
            </div>
        </fieldset>
    </div>
</div>

<script type="module">
    import QrScanner from "https://unpkg.com/qr-scanner@latest/qr-scanner.min.js";

    document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("qrImageInput");
        const alertDiv = document.getElementById("alertDiv");

        fileInput.addEventListener("change", async function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const imageURL = URL.createObjectURL(file);
            const img = new Image();
            img.src = imageURL;
            img.onload = async function () {
                try {
                    const result = await QrScanner.scanImage(img);
                    window.location.href = result;
                } catch (error) {
                    showAlert("لم يتم العثور على كود QR، تأكد من وضوح الصورة", "danger");
                }
            };
        });

        function showAlert(message, type) {
            alertDiv.innerHTML = message;
            alertDiv.className = `alert alert-${type} text-center mt-5`;
            alertDiv.hidden = false;
        }
    });
</script>



{% endblock %}
